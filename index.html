<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PILL Presale</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'Courier New', monospace;
    background: black;
    color: #00ff00;
    overflow: hidden;
  }
  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
    text-align: center;
  }
  h1 { color: #00ffcc; font-size: 3rem; }
  .neon-button {
    background: none;
    border: 2px solid #00ffcc;
    color: #00ffcc;
    padding: 1rem 2rem;
    font-size: 1.2rem;
    margin: 1rem;
    cursor: pointer;
    transition: 0.3s;
  }
  .neon-button:hover { box-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc; }
  input {
    padding: 0.5rem;
    font-size: 1rem;
    width: 200px;
    margin-right: 1rem;
  }
  .bar-container { width: 100%; background-color: #111; border: 1px solid #00ff00; margin: 1rem 0; }
  .bar { width: 0%; height: 20px; background-color: #00ffcc; }
</style>
</head>
<body>

<div class="container">
  <h1>PILL Presale</h1>
  <p>Token: <strong>PILL</strong></p>
  <p>Preço inicial: <strong>0.003 ETH</strong></p>
  <div class="bar-container"><div class="bar" id="marketCapBar"></div></div>
  <p>Market Cap: <span id="marketCapPercent">0</span>%</p>
  <p>Tokens vendidos: <span id="tokensSold">0</span></p>
  <button class="neon-button" id="connectWalletBtn">Conectar MetaMask</button>
  <br>
  <input type="number" id="ethAmount" placeholder="ETH para comprar" step="0.001" min="0.001">
  <button class="neon-button" id="buyBtn">Comprar Tokens</button>
  <p id="status"></p>
</div>

<script>
const CONTRACT_ADDRESS = "0x6754c0f28ab363Ed6090843baeAb201C3CaCD96D";
const TOKEN_PRICE = 0.003; // ETH

let provider;
let signer;
let contract;

const abi = [
  "function buyTokens() external payable",
  "function progress() view returns(uint256)",
  "function tokensSold() view returns(uint256)"
];

async function connectWallet() {
  try {
    if (!window.ethereum) {
      alert("MetaMask não detectada. Instale MetaMask!");
      return;
    }

    provider = new ethers.providers.Web3Provider(window.ethereum, "any");
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, abi, signer);

    document.getElementById("status").innerText = "MetaMask conectada!";
    updateUI();
  } catch (err) {
    console.error(err);
    document.getElementById("status").innerText = "Erro ao conectar MetaMask!";
  }
}

async function updateUI() {
  if (!contract) return;
  try {
    const progressPercent = await contract.progress();
    const sold = await contract.tokensSold();
    document.getElementById("marketCapBar").style.width = progressPercent + "%";
    document.getElementById("marketCapPercent").innerText = progressPercent;
    document.getElementById("tokensSold").innerText = ethers.utils.formatUnits(sold, 18);
  } catch (err) {
    console.error(err);
  }
}

async function buyTokens() {
  if (!contract || !signer) {
    alert("Conecte a MetaMask primeiro!");
    return;
  }
  const ethAmount = parseFloat(document.getElementById("ethAmount").value);
  if (isNaN(ethAmount) || ethAmount <= 0) {
    alert("Digite um valor válido de ETH");
    return;
  }

  try {
    document.getElementById("status").innerText = "Aguardando assinatura na MetaMask...";
    const tx = await contract.buyTokens({ value: ethers.utils.parseEther(ethAmount.toString()) });
    await tx.wait();
    document.getElementById("status").innerText = "Compra realizada com sucesso!";
    updateUI();
  } catch (err) {
    console.error(err);
    document.getElementById("status").innerText = "Erro ao comprar token. Veja o console.";
  }
}

document.getElementById("connectWalletBtn").addEventListener("click", connectWallet);
document.getElementById("buyBtn").addEventListener("click", buyTokens);

setInterval(updateUI, 5000);
updateUI();
</script>

</body>
</html>
