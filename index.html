<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PILL Pre-Sale</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<style>
body { margin:0; padding:0; background:black; color:#00ffbf; font-family:Arial,sans-serif; }
.container { max-width:500px; margin:auto; padding:30px; text-align:center; }
button { padding:12px; margin-top:12px; border-radius:10px; border:none; cursor:pointer; background:#00ffbf; color:black; font-weight:bold; width:90%; }
button:hover { background:#ff0066; color:white; }
.card { margin-top:20px; padding:20px; border-radius:12px; background:rgba(0,0,0,0.6); border:1px solid #00ffbf; }
.progressBox { width:100%; height:22px; background:#222; border-radius:12px; margin-top:12px; overflow:hidden; border:1px solid #00ffbf; }
.progressFill { height:100%; width:0%; background:#00ffaa; transition:0.4s; }
</style>
</head>
<body>
<div class="container">
<h1>PILL Pre-Sale</h1>
<button id="connectBtn">Conectar MetaMask</button>
<div class="card">
<div id="priceDisplay">Preço: --</div>
<div id="marketCap">Market Cap: --</div>
<div class="progressBox"><div class="progressFill" id="progressFill"></div></div>
<div id="progressText" style="margin-top:8px;font-size:16px">Tokens Vendidos: --</div>
<input id="ethAmount" type="number" placeholder="Valor em ETH" style="width:90%;padding:12px;margin-top:14px;border-radius:8px;font-size:16px;" />
<button id="buyBtn">Comprar</button>
<button id="claimBtn">Claim</button>
</div>
</div>

<script>
const CONTRACT_ADDRESS = "0x6754c0f28ab363Ed6090843baeAb201C3CaCD96D";
const abi = [
    "function buyTokens() payable",
    "function claim()",
    "function totalRaisedETH() view returns(uint256)",
    "function tokensSold() view returns(uint256)",
    "function tokenPrice() view returns(uint256)",
    "function maxCapETH() view returns(uint256)"
];

let provider, signer, launchpad, account;

// Conectar MetaMask
async function connectWallet() {
    if(typeof window.ethereum === 'undefined') {
        alert("MetaMask não detectada! Instale e desbloqueie.");
        return;
    }

    try {
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        account = await signer.getAddress();

        launchpad = new ethers.Contract(CONTRACT_ADDRESS, abi, signer);

        document.getElementById("connectBtn").innerText = "Conectado: " + account.substring(0,6) + "..." + account.slice(-4);
        document.getElementById("connectBtn").style.background = "#00ffaa";

        updateUI();
    } catch(err) {
        console.error(err);
        alert("Erro ao conectar MetaMask! Veja console.");
    }
}

// Atualizar UI
async function updateUI() {
    if(!launchpad) return;
    try {
        const sold = await launchpad.tokensSold();
        const raised = await launchpad.totalRaisedETH();
        const price = await launchpad.tokenPrice();
        const maxCap = await launchpad.maxCapETH();

        document.getElementById("progressText").innerText = "Tokens Vendidos: " + ethers.utils.formatUnits(sold,18);
        const pct = Number(raised)/Number(maxCap)*100;
        document.getElementById("progressFill").style.width = pct + "%";
        document.getElementById("priceDisplay").innerText = "Preço atual: " + (Number(price)/1e18).toFixed(6) + " ETH";
        document.getElementById("marketCap").innerText = "Market Cap: " + (Number(price)/1e18 * Number(sold)/1e18).toFixed(4) + " ETH";
    } catch(err){ console.error(err); }
}

// Comprar Tokens
document.getElementById("buyBtn").addEventListener("click", async ()=>{
    if(!signer) return alert("Conecte MetaMask primeiro!");
    const ethAmount = document.getElementById("ethAmount").value;
    if(!ethAmount || ethAmount <= 0) return alert("Digite um valor válido");
    try {
        const tx = await launchpad.buyTokens({ value: ethers.utils.parseEther(ethAmount.toString()) });
        alert("Transação enviada. Confirme na MetaMask...");
        await tx.wait();
        alert("Compra confirmada!");
        updateUI();
    } catch(err){ console.error(err); alert("Erro ao comprar token! Veja console."); }
});

// Claim
document.getElementById("claimBtn").addEventListener("click", async ()=>{
    if(!signer) return alert("Conecte MetaMask primeiro!");
    try {
        const tx = await launchpad.claim();
        alert("Claim enviado. Aguarde confirmação...");
        await tx.wait();
        alert("Tokens recebidos!");
    } catch(err){ console.error(err); alert("Erro no claim! Veja console."); }
});

// Botão conectar
document.getElementById("connectBtn").addEventListener("click", connectWallet);
</script>
</body>
</html>
